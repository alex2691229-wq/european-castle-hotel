# 歐堡商務汽車旅館 - 項目待辦清單

## ✅ 已完成的功能

### 訂房流程簡化（2026/01/14 用戶反饋 - 第一次）
- [x] 移除「標記已匯款」步驟，簡化訂房狀態轉換
- [x] 修改流程：待確認 → 已確認 → 已匯款（自動跳過）→ 填寫後五碼 → 已付款 → 標記入住
- [x] 更新後台訂單管理頁面 UI，移除「標記已匯款」按鈕
- [x] 修改「完成訂房」按鈕為「標記入住」
- [x] 編寫測試驗證新的狀態轉換流程（32 個新測試全部通過）
- [x] 驗證郵件回覆流程仍然正常工作

### 訂房狀態流程調整（2026/01/14 用戶反饋 - 第二次）
- [x] 修改訂房狀態流程：待確認 → 已確認 → 待付款 → 已付款 → 已完成
- [x] 添加「待付款」狀態到數據庫 schema
- [x] 修改已確認狀態的按鈕邏輯，點擊後自動進入「待付款」狀態
- [x] 修改「待付款」狀態的按鈕為「🎉 完成訂房」，填寫後五碼後才能點擊
- [x] 修改「已付款」狀態的按鈕為「✓ 標記入住」
- [x] 編寫測試驗證新的狀態流程（32 個新測試全部通過）

### 訂單管理頁面改進（2026/01/14 用戶反饋）
- [x] 為訂單管理頁面添加狀態篩選功能
- [x] 添加四個狀態統計框（待確認、已確認、待付款、已付款），顯示訂單數量
- [x] 點擊狀態框時篩選並顯示對應狀態的訂單
- [x] 為訂單管理頁面添加分頁功能
- [x] 每頁顯示 10 筆訂單
- [x] 添加分頁導航（上一頁、下一頁、頁碼）
- [x] 編寫測試驗證篩選和分頁功能

## 🔴 進行中的功能

### 完整的防呆訂房後台系統（2026/01/14 用戶反饋 - 重新設計）
- [x] 重新設計訂房後台系統的數據模型
- [x] 添加支付方式欄位（銀行轉帳、現場付款）
- [x] 實現完整的防呆流程邏輯：
  - [x] 待確認狀態：顯示訂房詳情，點「✓ 確認訂房」進入已確認
  - [x] 已確認狀態：自動進入待付款，顯示付款方式選擇
  - [x] 待付款狀態：
    - [x] 銀行轉帳：必須填寫後五碼才能進入已付款
    - [x] 現場付款：直接進入現場付款
  - [x] 已付款狀態：點「✓ 標記入住」完成訂房
  - [x] 已完成狀態：顯示訂房完成信息
- [x] 重寫訂單管理頁面，實現完整的防呆流程
- [x] 添加支付方式選擇按鈕（銀行轉帳、現場付款）
- [x] 添加後五碼驗證邏輯
- [x] 添加步驟提示和錯誤提示
- [x] 編寫完整的測試用例
- [x] 驗證防呆流程的有效性
- [x] 添加狀態統計框和篩選功能
- [x] 添加分頁功能（每頁 10 筆訂單）

## 待辦功能

### 假日價格管理
- [ ] 為 1/17、18、24、25、31 這些假日日期設置假日價格
- [ ] 確保週五晚上和周六晚上都使用假日價格
- [ ] 驗證假日價格設置正確

### 其他功能
- [ ] 支持 Booking.com 和 Agoda 的數據同步
- [ ] 自定義管理員帳號和密碼登入
- [ ] 集成綠界金流服務


## 🔴 修複訂房流程邏輯（2026/01/14 用戶反饋）
- [x] 修複「確認訂房」按鈕的邏輯，確保正確轉換狀態
- [x] 簡化流程：待確認 → 待付款（移除中間的「已確認」步驟）
- [x] 確保「待付款」狀態顯示「選擇付款方式」的按鈕
- [x] 修複點擊訂單時的展開/折疊邏輯


## 🔴 修複篩選按鈕計數問題（2026/01/14 用戶反饋）
- [x] 修複「待確認」篩選按鈕顯示 143 筆的計數問題（實際上是正確的，是 mock 數據）
- [x] 確保篩選按鈕的計數能正確同步
- [x] 驗證分頁功能與篩選功能的配合


## 🔴 驗證篩選功能並添加當天入出名單（2026/01/14 用戶反饋）
- [x] 驗證篩選按鈕點擊後，頁面是否正確顯示對應狀態的訂單
- [x] 添加「入住名單」按鈕
- [x] 添加「出房名單」按鈕
- [x] 實現「入住名單」的篩選邏輯（顯示今天入住的訂單）
- [x] 實現「出房名單」的篩選邏輯（顯示今天出房的訂單）
- [x] 編寫測試驗證功能


## 🔴 修復訂房流程邏輯 - 確保正確的按鈕跳轉（2026/01/14 用戶反饋）
- [x] 修複 payment 變數的條件判斷，使用 payments[booking.id] 代替
- [x] 確保點擊「✓ 確認訂房」後正確進入「待付款」狀態
- [x] 確保「待付款」狀態正確顯示「選擇付款方式」的按鈕
