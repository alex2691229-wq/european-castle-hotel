# 歐堡商務汽車旅館 - 項目待辦清單

## 🔴 根據 Booking.com 設計重新構建訂房後台系統（2026/01/14）

### Phase 2：架構設計
- [x] 確認數據庫 schema 中的訂單狀態定義
- [x] 確認支付方式欄位（銀行轉帳、現場支付）
- [x] 確認後五碼欄位用於銀行轉帳驗證

### Phase 3：訂房流程和狀態管理
- [x] 實現訂房流程：待確認 → 已確認 → 待付款 → 已付款/現場付款 → 已完成
- [x] 實現「確認訂房」按鈕：待確認 → 已確認
- [x] 實現「選擇支付方式」步驟：已確認 → 待付款
- [x] 實現「銀行轉帳」選項：需要填寫後五碼才能進入已付款
- [x] 實現「現場支付」選項：直接進入現場付款狀態
- [x] 實現「標記入住」按鈕：已付款/現場付款 → 已完成

### Phase 3：快速篩選功能
- [x] 實現「全部訂單」篩選按鈕
- [x] 實現「待確認」篩選按鈕（顯示計数）
- [x] 實現「已確認」篩選按鈕（顯示計数）
- [x] 實現「當日入住」篩選按鈕（顯示計数）
- [x] 確保點擊篩選按鈕後頁面正確顯示對應訂單

### Phase 4：分頁功能
- [x] 實現每頁顯示 10 筆訂單
- [x] 實現「上一頁」按鈕
- [x] 實現「下一頁」按鈕
- [x] 實現頁碼導航
- [x] 確保分頁與篩選功能配合正常

### Phase 4：訂單詳情
- [x] 點擊訂單卡片展開詳細信息
- [x] 顯示客戶信息（姓名、電話、郵箱）
- [x] 顯示訂單信息（房型、入住日期、退房日期、價格）
- [x] 顯示支付信息（支付方式、支付狀態、後五碼）

### Phase 5：測試和驗證
- [x] 編寫单元測試驗證訂房流程
- [x] 編寫单元測試驗證篩選功能
- [x] 編寫单元測試驗證分頁功能
- [x] 在開發伊服務器上進行集成測試（437 個測試通過）
- [x] 驗證所有功能都能正確工作

## ✅ 已完成的功能

- [x] 項目初始化（web-db-user 模板）
- [x] 數據庫 schema 設計
- [x] 訂單狀態定義
- [x] 支付方式欄位
- [x] 後五碼驗證欄位
- [x] 研究 Booking.com 訂房管理系統設計

## 📋 其他待辦項目

- [ ] 為假日日期（1/17、18、24、25、31）設置假日價格
- [ ] 添加「取消訂單」功能
- [ ] 修復 db.ts 第 338 行的語法錯誤
- [ ] 修復 schema.ts 第 192 行的語法錯誤

## ✅ 訂房流程修復（2026/01/14 - 用戶反饋）

### 後端 API 開發
- [x] 添加 selectPaymentMethod API（選擇支付方式：銀行轉帳或現場支付）
- [x] 添加 confirmBankTransfer API（確認銀行轉帳後五碼）
- [x] 修改 markCheckedIn API 確保只有已付款或現場付款狀態才能標記入住

### 前端界面開發
- [x] 在「已確認」狀態下添加支付方式選擇按鈕（銀行轉帳、現場支付）
- [x] 在「待付款」狀態下添加銀行轉帳後五碼輸入欄位
- [x] 確保「標記入住」按鈕只在「已付款」或「現場付款」狀態下顯示
- [x] 修改快速篩選按鈕：全部訂單、待確認、已確認、待付款、當日入住

### 測試驗證
- [x] 運行單元測試驗證訂房流程邏輯
- [x] 確保所有測試通過（437/440 通過，3 個失敗為預先存在的房間可用性問題）
