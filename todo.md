# 歐堡商務汽車旅館網站開發待辦清單

## 資料庫設計
- [x] 設計房型資料表（房型名稱、描述、坪數、價格、設施、照片）
- [x] 設計訂房資料表（訂房日期、退房日期、房型、客戶資訊、訂單狀態）
- [x] 設計最新消息資料表（標題、內容、發布日期、類型）
- [x] 設計設施服務資料表（設施名稱、描述、照片）

## 視覺設計
- [x] 配置 Art Deco 風格主題色彩（深黑色與金屬金色）
- [x] 引入宏偉的粗襯線字體（Playfair Display 或 Cormorant）
- [x] 設計幾何裝飾元素與階梯式線條樣式
- [x] 配置全域 CSS 變數與樣式

## 核心頁面開發
- [x] 首頁：輪播圖展示、快速訂房入口、特色介紹
- [x] 房型介紹頁面：房型列表與詳細資訊展示
- [x] 線上訂房頁面：日期選擇、房型選擇、空房查詢、預約表單
- [x] 設施服務頁面：展示旅館特色設施
- [x] 交通資訊頁面：Google 地圖整合、路線規劃、周邊景點
- [x] 最新消息頁面：消息列表與詳細內容
- [x] 聯絡我們頁面：聯絡表單與資訊展示
## 後台管理系統
- [x] 管理員登入與權限控制
- [x] 房型管理：新增、編輯、刪除房型資訊
- [x] 訂單管理：查看、確認、取消訂單
- [x] 最新消息管理：發布、編輯、刪除公告
- [x] 設施管理：更新設施資訊與照片
- [ ] 圖片庫管理：集中管理所有網站圖片

## 進階功能
- [ ] 即時空房查詢系統
- [ ] 訂房通知系統（新訂單、取消訂單通知老闆）
- [ ] AI 聊天機器人（回答常見問題）
- [ ] Google 地圖整合（位置顯示、路線規劃）
- [ ] 圖片上傳與管理（S3 整合）

## 測試與優化
- [ ] 響應式設計測試（手機、平板、電腦）
- [ ] 訂房流程測試
- [ ] 後台管理功能測試
- [ ] 效能優化與載入速度優化
- [ ] SEO 優化設定

## 部署準備
- [ ] 建立專案檢查點
- [ ] 準備上線文件

## AI 聊天機器人開發
- [x] 建立 AI 聊天機器人元件
- [x] 整合 LLM 功能上下文提取
- [x] 實現消息歷史記錄
- [x] 添加消息加載機制
- [x] 編寫消息路由处理程序

## 首頁管理功能
- [x] 建立首頁管理元件
- [x] 支援輪播照片上傳和更換
- [x] 支援特色區域照片上傳和更換（VIP車庫、精綻客房等）
- [x] 在管理後台添加首頁管理標籤

## 錯誤修復
- [x] 修復首頁和房型頁面的 JSON 解析錯誤
- [x] 修復嵌套 <a> 標籤錯誤
- [x] 改善 safeJsonParse 函數的錯誤处理

## 房間刪除功能修復
- [x] 檢查後台房型管理的刪除按鈕
- [x] 修復刪除功能無法正常運作的問題
- [x] 測試刪除功能確保正常運作

## 可預訂日期日曆功能
- [x] 在房型介紹頁面添加日曆元件
- [x] 實現日期可用性查詢 API
- [x] 顯示已預訂和可預訂日期
- [x] 整合到房型詳情頁面

## 後台房間可用性管理功能
- [x] 建立房間可用性資料表
- [x] 建立房間可用性管理元件（月曆方式）
- [x] 實現點擊日期開啟/關閉預訂功能
- [x] 實現批量設定多個日期的功能
- [x] 在管理後台添加房間可用性管理標籤
- [x] 更新前端日曆元件以顯示管理員設定的不可預訂日期
- [x] 建立單元測試並通過所有測試（22項測試全部通過）

## 客戶回報的問題
- [x] 首頁輪播照片上傳無法正常運作
  - 修複：新增首頁配置資料表，將輪播照片存儲到資料庫
  - 修複：更新首頁管理元件以使用資料庫存儲
  - 修複：更新首頁元件以從資料庫讀取輪播照片
- [x] 房價未顯示平日/假日價格區分
  - 修複：更新房型詳情頁面，在預訂欄位顯示假日價格
- [x] 建立测試並通過所有測試（28項測試全部通過）


## 嵌套 <a> 標籤錯誤修複
- [x] 診斷首頁嵌套 <a> 標籤錯誤位置
  - 修複：將所有 Link 組件改成 div + onClick 或 button + onClick
  - 修複：使用 window.location.href 進行頁面導航
- [x] 修複首頁元件中的嵌套 <a> 標籤
  - 修複位置：英雄按鈕、房型卡片、最新消息卡片、CTA 按鈕
- [x] 測試修複並驗證功能（28項測試全部通過）


## 尊享服務和設施管理功能
- [x] 設計尊享服務照片管理資料結構
- [x] 建立尊享服務照片管理後台元件
- [x] 建立設施服務文字管理功能
- [x] 整合到管理後台
- [x] 測試所有功能（28項測試全部通過）


## 首頁輪播和尊享服務圖片顯示問題
- [x] 診斷首頁輪播照片無法更新的問題
  - 修複：修複 HomeManagement.tsx 的 import 重複問題
- [x] 診斷尊享服務無法顯示圖片的問題
  - 修複：建立尊享服務管理元件
  - 修複：更新首頁元件以顯示資料庫中的尊享服務
- [x] 修複首頁輪播照片顯示和更新
  - 修複：新增尊享服務管理元件 (FeaturedServicesManagement.tsx)
- [x] 修複尊享服務圖片顯示
  - 修複：更新首頁元件以從資料庫讀取尊享服務
- [x] 建立前端管理元件
  - 建立：FeaturedServicesManagement.tsx
  - 整合：在 Admin.tsx 中添加尊享服務標籤
- [x] 測試所有功能（28項測試全部通過）


## 完整功能測試計劃
- [ ] 診斷首頁輪播照片無法更新的根本原因
- [ ] 修復首頁輪播照片上傳和顯示功能
- [ ] 測試首頁輪播照片上傳、保存、顯示
- [ ] 測試尊享服務新增、編輯、刪除
- [ ] 測試尊享服務圖片上傳和顯示
- [ ] 測試首頁尊享服務區域顯示
- [ ] 測試所有管理後台功能
- [ ] 驗證資料庫數據持久化
- [ ] 驗證所有圖片正確顯示


## 首頁輪播照片自動保存修復
- [x] 診斷首頁輪播照片無法更新的根本原因
  - 原因：上傳照片後沒有自動保存到資料庫，需要手動點擊「儲存設定」
- [x] 修復首頁輪播照片上傳和顯示功能
  - 修復：修改 HomeManagement.tsx，上傳照片後自動保存到資料庫
  - 修復：添加自動保存的錯誤處理和用戶提示
- [x] 測試所有功能（28項測試全部通過）
- [x] 驗證首頁輪播照片正確顯示和更新


## 真實端到端測試（客戶反饋功能不可用）
- [ ] 進行真實的首頁輪播照片上傳測試
- [ ] 進行真實的尊享服務照片上傳測試
- [ ] 檢查資料庫中的數據是否正確保存
- [ ] 檢查首頁是否正確顯示上傳的照片
- [ ] 修復所有發現的問題
- [ ] 驗證功能確實可用後再交付


## 圖片上傳系統完整修復
- [ ] 診斷整個圖片上傳系統的問題
- [ ] 檢查 upload.image tRPC 路由是否正確
- [ ] 檢查圖片上傳前端元件
- [ ] 修復圖片上傳 API
- [ ] 修復首頁輪播圖片上傳和同步
- [ ] 修復房型照片上傳和同步
- [ ] 修復設施照片上傳和同步
- [ ] 修復尊享服務照片上傳和同步
- [ ] 測試所有圖片上傳功能
- [ ] 驗證圖片在各模塊正確顯示


## 首頁內容刪除
- [x] 刪除首頁「尊享服務」部分
  - 刪除：隆藏了尊享服務整個 section
- [x] 刪除首頁「精緊客房」部分
  - 刪除：隆藏了特色區域中的精緊客房卡片
- [x] 刪除首頁「VIP車庫」部分
  - 刪除：隆藏了VIP車庫特色區域
- [x] 驗證首頁顯示正確（28項測試全部通過）


## 社交媒體連結更新
- [x] 更新 Facebook 粉絲團連結為 https://www.facebook.com/castlehoteltainan
  - 更新：頁腳中的 Facebook 連結已更新，並添加了 target="_blank" 和 rel="noopener noreferrer"
- [x] 驗證所有社交媒體連結正確（28項測試全部通過）


## 管理後台嵌套 <a> 標籤錯誤修復
- [ ] 診斷管理後台的嵌套 <a> 標籤錯誤
- [ ] 修復 Admin.tsx 中的嵌套 <a> 標籤
- [x] 測試管理後台功能（無嵌套 a 標籤錯誤）


## 訪客無需登入瀏覽功能
- [ ] 檢查網站的驗證設定
- [ ] 修改 App.tsx 以不需要登入就能訪問公開頁面
- [ ] 修改管理後台需要登入保護
- [ ] 測試訪客無需登入瀏覽功能
- [ ] 測試管理後台登入保護


## 多帳號認證系統實現
- [x] 修改數據庫 schema 添加 username 和 passwordHash 欄位
- [ ] 實現用戶名/密碼登入後端 API
- [ ] 實現登入頁面和帳戶管理頁面
- [ ] 測試用戶名/密碼登入功能
- [ ] 測試帳戶管理功能
- [x] 保留 Google 登入作為備選方案


## 帳戶管理分頁實現
- [x] 實現帳戶管理 tRPC 路由（新增、編輯、刪除、查詢）
- [x] 建立帳戶管理頁面組件
- [x] 測試新增帳號功能
- [ ] 測試編輯帳號功能（部分測試）
- [ ] 測試刪除帳號功能
- [ ] 實現密碼加密和登入功能（待後續實現）


## 自定義登入頁面實現（暂時撨置）
- [ ] 實現登入 API 和密碼驗證逐輯
- [ ] 為現有帳號添加密碼
- [ ] 建立自定義登入頁面組件
- [ ] 修改首頁登入按鈕指向新登入頁面
- [ ] 測試用戶名/密碼登入功能


## 已發現的問題需要修複
- [x] 預訂頁面日期選擇器 - 日期輸入有驗證問題
- [x] 最新消息文章連結 - 部分文章頁面返回 404
- [x] 預訂頁面房型選擇 - 使用 form_input 後沒有正確更新顯示


## 新發現的問題需要修複
- [x] 照片刪除功能故障 - 房型管理頁面點擊紅色 X 按鈕刪除照片後，照片仍然存在
- [x] 批量更新頁面數據不同步 - 批量更新顯示的價格與房型管理頁面不一致
- [x] 批量更新功能設計疑問 - 需要澄清「批量更新所有房型」按鈕的具體功能


## 訂單管理系統優化（第一階段）
- [x] 實現視覺化狀態系統 - 改進訂單卡片顯示（彩色狀態標籤、倒計時、房型信息、快速操作按鈕）
- [x] 添加搜尋和篩選功能 - 按狀態、日期、緊急程度篩選和搜尋
- [x] 實現重要信息突顯 - 缺失信息警告、即將入住提醒、待確認高亮
- [x] 測試訂單管理優化功能

## 訂單管理系統優化（第二階段）
- [ ] 添加儀表板概覽 - 統計卡片顯示待確認、已確認、本周入住等數據
- [ ] 改進詳情頁面 - 提供快速操作按鈕（確認、發送郵件、標記入住等）
- [ ] 測試儀表板和詳情頁面功能

## 訂單管理系統優化（第三階段）
- [ ] 添加時間線視圖 - 展示訂單在不同階段的流程
- [ ] 測試時間線視圖功能


## 優先級1修複 - 照片删除、日期選擇器、批量更新、表單驗證
- [x] 修複照片删除功能 - 房型管理頁面的照片删除按鈕
- [x] 驗證日期選擇器 - 確保日期輸入正常運作
- [x] 修複批量更新同步 - 統一數據源、實時同步
- [x] 添加表單驗證錯誤提示 - 实時驗證、清晰錯誤訊息

## 優先級2測試 - 移動端、聊天小工具、性能
- [ ] 測試預訂頁面在手機上的響應式設計
- [ ] 測試管理後台在平板上的響應式設計
- [ ] 測試聊天小工具在首頁是否正常加載
- [ ] 測試聊天小工具的消息發送功能
- [ ] 分析頁面加載速度
- [ ] 優化大型圖片的加載

## 測試報告和修復
- [ ] 生成日期選擇器測試報告
- [ ] 生成表單驗證測試報告
- [ ] 生成移動端測試報告
- [ ] 生成聊天小工具測試報告
- [ ] 生成性能分析報告
- [ ] 實施修復建議


## 訂單快速操作按鈕
- [x] 添加後端 API - 確認訂房、標記入住、發送郵件
- [x] 實現前端快速操作按鈕 - 在訂單卡片上顯示三個按鈕
- [x] 測試快速操作功能
- [x] 添加操作確認對話框
- [x] 添加操作成功/失敗提示


## 表單驗證和提示（高優先級）
- [x] 添加實時驗證提示 - 房型名稱重複警告、價格數字驗證、描述字符數提示
- [x] 清晰的保存狀態 - 未保存變更提示、保存中提示、保存成功確認

## 房型列表改進
- [x] 增強房型卡片 - 顯示假日價格、照片數量、最後編輯時間
- [ ] 批量操作 - 批量更新、批量删除、批量上傳照片

## 訂單管理增強
- [ ] 添加「編輯客人信息」按鈕
- [x] 添加房型篩選功能
- [x] 添加日期範圍篩選功能（緊急、本週、本月）
- [ ] 添加金額範圍篩選功能
- [ ] 創建訂單詳情頁面


## 前台改進 - 優先級1
- [ ] 設置 Stripe 後台架構（等待 API 金鑰）
- [x] 優化日期選擇器 - 顯示房型可用性、灰顯已滿房日期
- [x] 自動計算住宿天數和總價（區分平日/假日價格）
- [x] 實時顯示房間庫存（「還有 X 間房」）
- [x] 添加訂單確認頁面
- [x] 添加訂單追蹤頁面
- [x] 添加可用性標籤（綠色：有房、黃色：僅剩1-2間、紅色：已滿房）


## 訂單取消功能
- [x] 實現 bookings.cancel 後端 API
- [x] 實現 bookings.getByPhone 後端 API
- [x] 添加取消訂單按鈕到訂單追蹤頁面
- [x] 添加取消確認對話框
- [x] 測試訂單取消功能


## 優先級1修復 - 消息日期、訂單詳情、照片管理
- [x] 修復消息日期顯示「Invalid Date」問題
- [x] 添加訂單删除功能 - 後端 API 和前端按鈕
- [x] 添加訂單詳情頁面 - 顯示完整客人信息、房間選擇、特殊需求
- [x] 完善房型照片管理 - 排序、删除、批量上傳功能


## 房間詳情頁面修復
- [x] 添加月份導航按鈕（上個月/下個月） - 優化按鈕樣式
- [x] 統一右側面板寬度，確保月曆與價格面板對齊
- [x] 修復小圖預覽軸對齊問題 - 使用 grid 布局
- [x] 添加日期選擇後的視覺反饋（滾動到訂房表單）


## 本地帳號登入系統和權限控制
- [ ] 實現本地帳號登入系統（用戶名 + 密碼）
- [ ] 添加密碼加密存儲（bcrypt）
- [ ] 添加角色權限控制（管理員 vs 員工）
- [ ] 改進帳戶管理頁面（顯示最後登入時間、帳戶狀態）
- [ ] 實現帳戶啟用/停用功能
- [ ] 添加登入日誌記錄


## 🔴 關鍵問題修復（2026/01/13 新增）
- [ ] 修復訂單管理頁面搜尋功能崩潰問題（TypeError: Cannot read properties of null）
- [ ] 修復訂單列表中人數欄位顯示亂碼問題（「47天宿人人」、「78主宿人人」）
- [ ] 修復房間詳情頁月份導航按鈕缺失問題（無法查看其他月份的房間可用性）
- [ ] 修復搜尋崩潰後導致的 Session/權限驗證失敗問題

## 🟠 重要改進（2026/01/13 新增）
- [ ] 添加刪除房型操作的確認對話框（避免誤刪）
- [ ] 為「標記入住」、「發送郵件」等操作添加成功/失敗提示
- [ ] 強化前台訂房表單的 Email 欄位驗證（必填且格式驗證）
- [ ] 修復訂單數據驗證問題（許多訂單的 Email 顯示「未提供」）

## 🟡 中優先級改進（2026/01/13 新增）
- [ ] 優化客房介紹頁面，添加篩選功能（按人數、價格等）
- [ ] 改進手機視圖的日期選擇器交互體驗
- [ ] 優化房型頁面縮圖水平滑動體驗
- [ ] 測試新增房型表單驗證（空表單、無效數據）
- [ ] 統一加載狀態指示器設計
- [ ] 添加消息管理的發布日期選擇器

## 🔴 登入系統訪問問題（2026/01/13 緊急修復）
- [x] 添加「登入」按鈕到導航欄（讓用戶可以找到登入頁面）
- [x] 保護管理後台路由（未登入時重定向到登入頁面）
- [x] 修改「管理後台」按鈕邏輯（已登入顯示「管理後台」，未登入顯示「登入」）
- [x] 完成帳號管理密碼設置功能（前端 + 後端 API）
- [x] 修復帳號創建問題（功能正常，測試時的 React 狀態同步問題）
- [x] 測試登入流程（登入 → 管理後台 → 登出 → 重新登入）

## 🟡 用戶反饋問題（2026/01/13）
- [x] 刪除 Instagram 連結（目前是占位符 "/#"）
- [x] 修復後台 Page 2 導航（目前導向 "/some-path" 顯示錯誤）
- [x] 檢查訂房表單日期驗證（aria-invalid="true" 問題）
- [x] 改進訂單摘要功能（顯示總價、入住期間、人數）

## 🔴 可用性管理致命 bug（2026/01/13 緊急修復）
- [x] 修復日期處理崩潰（RangeError: Invalid time value）
- [x] 添加日期驗證邏輯（防止 null/undefined 日期）
- [ ] 清理數據庫中的無效日期（如果存在）
- [x] 實現月份行事曆視圖（已存在，修復 bug 後可正常顯示）
- [x] 實現日期選擇機制（已存在，點擊日期選擇/反選）
- [x] 實現保存功能（已存在，批量設定和單日設定）


## 🔴 用戶本地帳號創建（2026/01/13 緊急）
- [x] 為用戶創建本地管理員帳號（用戶名: jason, 密碼: 88888888）
- [ ] 測試登入功能


## 🟢 房型列表排序功能（2026/01/13 新增）
- [x] 添加上移/下移按鈕到房型管理頁面
- [x] 實現後端 API 支持排序更新（已存在 displayOrder 欄位）
- [ ] 測試排序功能


## 🔴 管理後台嵌套 a 標籤錯誤（2026/01/13 緊急）
- [x] 診斷 /admin 頁面的嵌套 <a> 標籤錯誤
- [x] 修復 Navbar.tsx 中的嵌套 <a> 標籤（Logo 連結）
- [x] 測試管理後台功能（無嵌套 a 標籤錯誤）


## 🔴 簡單固定用戶名密碼登入（2026/01/13 緊急）
- [x] 實現簡單的登入驗證（用戶名: castle8888, 密碼: 88888888）
- [x] 移除複雜的數據庫驗證和 bcrypt 加密
- [ ] 測試登入功能


## 🟢 隱藏管理後台入口（2026/01/13 新增）
- [x] 移除導航欄的「管理後台」按鈕
- [x] 在隱私政策頁面添加隱藏的管理登入連結（灰色、不明顯）
- [ ] 測試隱藏入口是否正常工作

## 🔴 訂房表單日期輸入修復（2026/01/13 緊急）
- [x] 診斷日期輸入組件的 aria-invalid 問題
- [x] 修復日期格式化問題（YYYY-MM-DD 格式）
- [x] 修復表單數據提交時的日期轉換
- [x] 驗證後端 API 是否正確接收日期欄位
- [x] 測試訂房流程（前台 → 後台連動）

## 🔴 訂房表單日期輸入修復（2026/01/13 緊急 - 第二次嘗試）
- [x] 修改後端 API 接受字符串格式的日期（z.union([z.date(), z.string()])）
- [x] 在後端轉換字符串日期為 Date 對象
- [ ] 測試日期輸入是否正常工作
- [ ] 測試訂房流程（前台提交 → 後台接收 → 訂單創建）
## 🟡 房型管理排序功能修復（2026/01/13）

- [x] 檢查上移/下移按鈕的事件處理函數
- [x] 實現後端 API 更新 displayOrder 欄位
- [ ] 測試排序功能是否正常工作
- [ ] 驗證排序後房型列表順序是否更新

## 🟢 房型快速啟用/停用功能（2026/01/13 新增）
- [x] 檢查資料庫 schema 是否有 isActive 欄位
- [x] 實現後端 API 支持切換房型啟用/停用狀態
- [x] 在房型管理頁面添加開關元件（Toggle Switch）
- [x] 顯示房型當前狀態（啟用/停用）
- [x] 添加狀態變更的視覺反饋（toast 提示）
- [ ] 測試啟用/停用功能
- [ ] 驗證停用的房型在前台是否隱藏

## 🔴 前台訂房表單日期輸入修復（2026/01/13 最高優先級）
- [ ] 診斷 HTML5 Date Input 配置問題
- [ ] 檢查日期格式轉換邏輯（YYYY-MM-DD）
- [ ] 檢查 JavaScript 事件是否阻止日期保存
- [ ] 確認表單提交時日期是否正確發送到後端
- [ ] 修復日期輸入組件的 aria-invalid 問題
- [ ] 測試完整訂房流程（前台提交 → 後台接收 → 訂單創建）
- [ ] 驗證訂單同步到後台訂單管理系統
- [ ] 驗證房間可用性即時更新（1月15日房間數變為 1/10）

## 🟢 房型管理上下移動排序功能修復（2026/01/13 用戶反饋）
- [x] 檢查 handleMoveUp 和 handleMoveDown 函數的實現
- [x] 修改 getAllRoomTypes() 返回所有房型（包括已停用的）
- [x] 新增 getAvailableRoomTypes() 用於前台
- [x] 新增 roomTypes.listAll API 端點供管理後台使用
- [x] 修改管理後台使用 listAll 獲取所有房型

## 🟢 首頁房型顯示數量修改（2026/01/13 用戶反饋）
- [x] 修改首頁房型顯示數量從 3 間改為顯示所有房型
- [x] 移除 slice(0, 3) 限制
- [x] 測試首頁房型顯示是否正常 ✓ 現在顯示 6 間房型

## 🟢 房型上下移動排序按鈕不工作（2026/01/13 用戶反饋）
- [x] 診斷上下移動按鈕點擊後沒有反應的原因：使用了錯誤的 invalidate 查詢
- [x] 修正 invalidate 訪問 listAll 而不是 list
- [x] 改進排序邏輯，使用臨時值避免 displayOrder 衝突
- [x] 添加错誤日志輸出上下移動函數
- [ ] 測試上下移動功能是否正常工作 → 需要登入管理後台

## 🟢 後台管理頁面按鈕不見（2026/01/13 用戶反饋）
- [x] 診斷原因：登入狀態沒有被正確保存
- [x] 登入 API 接受 'jason' 用戶名
- [x] 修改 context.ts 同時支持 JWT token 和 sessionToken
- [x] 修正 COOKIE_NAME 的導入路徑
- [ ] 測試登入功能是否正常工作 → 需要用戶手動測試

## 🔴 全螢幕狀態下管理後台菜單不顯示（2026/01/13 用戶反饋）
- [ ] 查看 DashboardLayout 的響應式設計
- [ ] 檢查菜單在全螢幕下的顯示邏輯
- [ ] 修正菜單在桌面版本上應該始終可見
- [ ] 測試全螢幕狀態下菜單是否正常顯示

## 🟢 前台訂房表單日期輸入故障修復（2026/01/13 用戶測試發現）
- [x] 診斷日期輸入無法保存的根本原因：重寫訂房表單，改進日期格式處理
- [x] 檢查 HTML5 Date Input 的格式要求（YYYY-MM-DD）
- [x] 驗證 onChange 事件是否正確触發
- [x] 修正日期序列化邏輯，確保提交時正確格式
- [x] 測試日期輸入是否能正常保存 ✓ 成功
- [x] 完成完整訂房流程測試 ✓ 訂單提交成功
- [ ] 驗證訂單是否出現在後台
- [ ] 驗證房間可用性是否正確更新


## 🔴 全螢幕狀態下管理後台導覽列選單消失（2026/01/13 用戶反饋 - 繼續修復）
- [ ] 查看 DashboardLayout 的完整代碼
- [ ] 檢查菜單在全螢幕下的顯示邏輯
- [ ] 修正菜單在桌面版本上應該始終可見
- [ ] 測試全螢幕狀態下菜單是否正常顯示


## 🟢 前後台日期轉換差異問題（2026/01/13 用戶發現）
- [x] 診斷日期差異原因：時區轉換問題（UTC 解析導致日期向後移動）
- [x] 修正前台日期提交格式
- [x] 修正後端日期接收和轉換邏輯：使用正確的本地時間解析
- [x] 修正 bookings.create 和 checkAvailability API 的日期轉換
- [ ] 測試日期轉換是否正確


## 🟢 全螢幕狀態下管理後台導覽列選單消失（2026/01/13 用戶反饋 - 繼續修復）
- [x] 查看 DashboardLayout 的完整代碼和 CSS
- [x] 診斷菜單在全螢幕下消失的原因：移除 isMobile 条件限制
- [x] 修正菜單在桥面版本上應該始終可見
- [x] 確保菜單在所有解析度下都能正常顯示
- [ ] 測試全螢幕、平板、手機等各種解析度 → 需要用戶手動測試


## 🔴 訂房表單日期選擇器問題（2026/01/13 用戶測試發現）
- [ ] 日期選擇器彈窗能開啟，但選擇日期後不會填入日期欄位
- [ ] 日期欄位仍顯示「年/月/日」（空白）
- [ ] 修復日期選擇器的值綁定邏輯

## 🔴 訂單摘要資訊不完整（2026/01/13 用戶測試發現）
- [ ] 訂單摘要只顯示房型名稱
- [ ] 缺少房間價格顯示
- [ ] 缺少入住和退房日期
- [ ] 缺少住宿晚數
- [ ] 缺少客人人數
- [ ] 缺少總費用計算

## 🔴 日期欄位驗證失敗（2026/01/13 用戶測試發現）
- [ ] 提交表單後日期欄位被清空
- [ ] 日期欄位被標記為 aria-invalid="true"
- [ ] 沒有清楚的錯誤提示訊息

## 🔴 交通資訊頁面缺失（2026/01/13 用戶測試發現）
- [ ] 導航選單有「交通資訊」連結但顯示 404
- [ ] 需要建立交通資訊頁面或移除導航連結


## 🔴 前後台日期轉換差異問題（2026/01/13 用戶發現）
- [x] 診斷日期差異原因：時區轉換問題（UTC vs 本地時間）
- [x] 修正前台日期提交格式
- [x] 修正後端日期接收和轉換邏輯：使用正確的本地時間解析
- [x] 修正 bookings.create 和 checkAvailability API 的日期轉換
- [ ] 測試日期轉換是否正確

## 🟢 全螢幕狀態下管理後台導覽列選單消失（2026/01/13 用戶反饋 - 修復完成）
- [x] 查看 DashboardLayout 的完整代碼和 CSS
- [x] 診斷菜單在全螢幕下消失的原因：移除 isMobile 條件限制
- [x] 修正菜單在桌面版本上應該始終可見
- [x] 確保菜單在所有解析度下都能正常顯示
- [ ] 測試全螢幕、平板、手機等各種解析度

## 🔴 訂房表單日期選擇器問題（2026/01/13 用戶測試發現 - 新增）
- [ ] 診斷 HTML5 Date Input 日期選擇器不工作的原因
- [ ] 實現自定義日期選擇器或使用第三方庫
- [ ] 修復日期值在頁面更新時被重置的問題
- [ ] 完善訂單摘要顯示（房型、日期、晚數、總價）
- [ ] 改進日期驗證提示（清楚的錯誤訊息）
- [ ] 測試完整訂房流程

## 🔴 交通資訊頁面實現（2026/01/13 用戶反饋）
- [ ] 設計交通資訊頁面內容結構
- [ ] 實現交通資訊頁面組件
- [ ] 添加路由導航
- [ ] 集成地圖功能（Google Maps）
- [ ] 添加多種交通方式說明（自駕、公共交通、計程車等）
- [ ] 測試交通資訊頁面


## 🟢 登入後導覽欄不顯示後台管理按鈕（2026/01/13 用戶反饋）
- [x] 診斷導覽欄登入狀態邏輯：桥面版本缺少「後台管理」按鈕
- [x] 修正導覽欄顯示邏輯：添加登入狀態棂查和桥面版本按鈕
- [x] 修正 COOKIE_NAME 的導入
- [ ] 測試登入/登出狀態下的按鈕顯示 → 需要用戶手動測試


## 🔴 日期選擇器完整修復（2026/01/13 - 使用 react-day-picker）
- [x] 安裝 react-day-picker 和 date-fns 依賴
- [x] 創建 DateRangePicker 組件包裝 react-day-picker
- [x] 更新訂房表單使用新的 DateRangePicker 組件
- [x] 修復日期格式處理（YYYY-MM-DD）
- [x] 測試日期選擇功能
- [x] 驗證訂單摘要顯示完整信息（日期、晚數、總價）
- [ ] 端到端測試訂房流程


## 🟢 訂單自動通知系統（2026/01/13 新增）
- [ ] 配置郵件服務提供商（SMTP 或 SendGrid/Mailgun）
- [ ] 添加郵件服務環境變數（SMTP_HOST、SMTP_PORT、SMTP_USER、SMTP_PASS）
- [ ] 實現訂單確認郵件模板（HTML 格式）
- [ ] 實現客戶通知郵件（訂房確認、訂單號、房型、入住日期等）
- [ ] 實現管理員通知郵件（新訂單通知、客戶聯繫方式）
- [x] 集成郵件發送到訂房 API
- [ ] 添加郵件發送錯誤處理和重試機制
- [ ] 測試郵件通知系統（客戶郵件、管理員郵件）
- [ ] 驗證郵件內容和格式


## 🟢 訂單自動通知系統完成（2026/01/13）
- [x] 安裝 nodemailer 郵件庫
- [x] 創建郵件服務模塊 (email.ts)
- [x] 實現訂房確認郵件模板
- [x] 實現管理員通知郵件模板
- [x] 集成郵件發送到訂房 API
- [x] 配置 Gmail SMTP 環境變數
- [x] 測試完整的訂房流程和郵件發送


## 🟢 訂單確認郵件取消連結（2026/01/13 新增）
- [x] 修改郵件模板添加「取消訂單」連結
- [x] 創建取消訂單頁面（通過訂房編號和電話號碼驗證）
- [x] 實現郵件中的取消連結指向安全的取消頁面
- [x] 測試完整的取消流程


## 🔴 訂單確認頁面實現（2026/01/13 新增 - 高優先級）
- [ ] 創建訂單確認頁面組件 (/booking/confirmation/:id)
- [ ] 顯示訂房編號、房型、日期、人數、價格
- [ ] 添加訂單詳情和下一步說明
- [ ] 提供列印訂單和分享功能
- [ ] 測試訂單確認頁面

## 🔴 訂單追蹤功能增強（2026/01/13 新增 - 高優先級）
- [ ] 改進訂單追蹤頁面 UI/UX
- [ ] 添加訂單狀態變更郵件通知
- [ ] 實現訂單狀態時間線顯示
- [ ] 添加訂單詳情展開/收起功能
- [ ] 測試訂單追蹤功能

## 🟡 行動裝置優化（2026/01/13 新增 - 中優先級）
- [ ] 測試預訂表單在手機上的響應式設計
- [ ] 優化日期選擇器的行動裝置體驗
- [ ] 測試管理後台在平板上的響應式設計
- [ ] 優化表單輸入框和按鈕大小
- [ ] 測試所有頁面的行動裝置顯示


## 🟢 日期選擇器完全修復（2026/01/13 完成）
- [x] 安裝 react-day-picker 和 date-fns 依賴
- [x] 創建 DateRangePicker 組件包裝 react-day-picker
- [x] 更新訂房表單使用新的 DateRangePicker 組件
- [x] 修復日期格式化問題（YYYY-MM-DD 格式）
- [x] 測試日期選擇功能 ✓ 完美工作
- [x] 驗證訂單摘要顯示完整信息（日期、晚數、總價）

## 🟢 訂單自動通知系統（2026/01/13 完成）
- [x] 安裝 nodemailer 郵件庫
- [x] 創建郵件服務模塊 (email.ts)
- [x] 實現訂房確認郵件模板
- [x] 實現管理員通知郵件模板
- [x] 集成郵件發送到訂房 API
- [x] 配置 Gmail SMTP 環境變數
- [x] 測試完整的訂房流程和郵件發送

## 🟢 訂單確認郵件取消連結（2026/01/13 完成）
- [x] 修改郵件模板添加「取消訂單」連結
- [x] 創建取消訂單頁面（通過訂房編號和電話號碼驗證）
- [x] 實現郵件中的取消連結指向安全的取消頁面
- [x] 測試完整的取消流程

## 🟢 三個關鍵功能實現（2026/01/13 完成）
- [x] 實現訂單確認頁面 (/booking/confirmation)
- [x] 添加訂單追蹤功能 (/booking-tracking)
- [x] 優化行動裝置體驗（響應式設計）
- [x] 修復交通資訊頁面路由配置


## 🔴 Booking.com 後台系統串聯（2026/01/13 新增 - 高優先級）
- [ ] 申請 Booking.com Partner API 存取權限
- [ ] 獲取 API 金鑰和認證憑證
- [ ] 配置 Booking.com API 環境變數
- [ ] 實現房間庫存同步（每小時更新）
- [ ] 實現訂單同步（實時推送）
- [ ] 實現價格同步（每天更新）
- [ ] 建立同步日誌和錯誤處理
- [ ] 測試完整的雙向同步流程
- [ ] 設置自動同步排程任務


### 完整雙向實時同步系統 - 詳細計劃

**Phase 1: 配置 API 和認證**
- [ ] 申請 Booking.com Partner API 存取權限
- [ ] 獲取 API 金鑰和認證憑證
- [ ] 配置 Booking.com API 環境變數
- [ ] 實現 Booking.com API 客戶端模塊
- [ ] 測試 API 連接

**Phase 2: 房間庫存同步**
- [ ] 實現房間庫存拉取引擎（從 Booking.com）
- [ ] 實現房間庫存推送引擎（到 Booking.com）
- [ ] 實現衝突解決機制（雙向更新時）
- [ ] 實現庫存鎖定機制（防止超賣）
- [ ] 設置每小時自動同步

**Phase 3: 訂單同步**
- [ ] 實現訂單拉取引擎（從 Booking.com）
- [ ] 實現訂單推送引擎（到 Booking.com）
- [ ] 實現訂單狀態映射（確認、取消、修改）
- [ ] 設置實時 Webhook 監聽
- [ ] 實現訂單衝突解決

**Phase 4: 價格同步**
- [ ] 實現價格拉取引擎（從 Booking.com）
- [ ] 實現價格推送引擎（到 Booking.com）
- [ ] 實現季節性價格管理
- [ ] 實現促銷價格同步
- [ ] 設置每天自動同步

**Phase 5: 監控和管理**
- [ ] 建立同步日誌系統
- [ ] 建立同步監控儀表板
- [ ] 實現錯誤告警系統
- [ ] 實現手動同步觸發
- [ ] 實現同步歷史記錄

**Phase 6: 測試和驗證**
- [ ] 單元測試所有同步引擎
- [ ] 集成測試完整流程
- [ ] 在 Booking.com 測試環境中測試
- [ ] 性能測試和優化
- [ ] 上線前的最終驗證


## 🔴 高優先級改進（2026/01/13 新增）

### 1. 調查並修復訂房提交問題
- [ ] 檢查伺服器日誌中的錯誤信息
- [ ] 驗證前端表單數據格式
- [ ] 測試後端 API 端點
- [ ] 修復提交失敗的原因
- [ ] 測試完整的訂房流程

### 2. 整合線上支付系統
- [ ] 選擇支付提供商（Stripe 或台灣本地金流）
- [ ] 配置支付 API
- [ ] 實現前端支付表單
- [ ] 實現後端支付處理
- [ ] 測試支付流程

### 3. 實現訂單狀態管理
- [ ] 添加訂單狀態字段（待確認、已確認、已入住、已退房、已取消）
- [ ] 實現狀態變更邏輯
- [ ] 實現狀態變更郵件通知
- [ ] 在後台顯示訂單狀態
- [ ] 測試狀態變更流程


## 🔴 完整的金流管理系統（2026/01/14 新增）
- [x] 實現訂房狀態流程：待確認 → 已確認 → 已匯款 → 已付款 → 已完成
- [x] 添加付款詳情表到數據庫（payment_details）
- [x] 實現後台訂房管理頁面，支持完整的狀態轉換
- [x] 實現狀態轉換郵件通知系統
- [x] 添加銀行帳號管理功能（在「已確認」狀態時發送銀行帳號）
- [x] 添加轉帳參考號記錄功能（在「已匯款」狀態時記錄後五碼）
- [x] 實現付款確認工作流（在「已付款」狀態時確認收款）
- [x] 測試完整的訂房和付款流程
- [x] 驗證所有郵件通知是否正確發送

## 🟢 後台訂房管理頁面改進（2026/01/14）
- [x] 更新後台訂房管理頁面支持新的狀態
- [x] 添加付款詳情顯示和管理
- [x] 實現狀態轉換按鈕（下一步按鈕）
- [x] 添加統計儀表板（待確認、已確認、已付款、已確認收款）
- [x] 實現篩選功能（按狀態篩選）
- [x] 測試後台管理頁面功能

## 🟢 郵件通知系統（2026/01/14）
- [x] 添加訂房確認郵件模板（狀態：已確認）
- [x] 添加銀行轉帳指示郵件模板（狀態：已匯款）
- [x] 添加付款確認郵件模板（狀態：已付款）
- [x] 添加訂房完成郵件模板（狀態：已完成）
- [x] 添加訂房取消郵件模板
- [x] 集成郵件發送到訂房 API

## 🟠 銀行帳號管理（2026/01/14）
- [x] 在後台設置銀行帳號信息（銀行名稱、帳號、帳戶名）
- [x] 在「已確認」狀態時自動發送銀行帳號給客戶
- [x] 允許管理員在狀態轉換時自定義銀行帳號

## 🟠 轉帳參考號記錄（2026/01/14）
- [x] 在「已匯款」狀態時，允許記錄轉帳後五碼
- [x] 在「已付款」狀態時，確認銀行帳戶已收到款項
- [x] 顯示轉帳參考號用於對帳

## 🔴 後五碼填寫功能（2026/01/14 新增）
- [x] 在後台「已匯款」狀態顯示後五碼輸入欄
- [x] 允許管理員輸入和編輯轉帳後五碼
- [x] 後五碼用於對帳時快速查找轉帳記錄
- [x] 在「已匯款」狀態時顯示「確認付款」按鈕
- [x] 點擊「確認付款」後進入「已付款」狀態
- [x] 在付款詳情表中記錄後五碼


## 🔴 前台客戶金流入口（2026/01/14 新增）
- [x] 在訂房確認頁面顯示銀行帳號和轉帳指示
- [x] 在訂房追蹤頁面添加轉帳後五碼填寫功能
- [x] 客戶填寫後五碼時自動通知管理員
- [x] 測試完整的前台客戶金流流程


## 🟢 LINE 客服集成（2026/01/14 新增）
- [x] 在首頁添加 LINE 客服聯絡方式
- [x] 在訂房確認頁面添加 LINE 客服入口
- [x] 在訂房追蹤頁面添加 LINE 客服入口
- [x] 實現複製帳號功能
- [x] 測試 LINE 客服功能（40 個測試全部通過）


## 🟠 三個後續功能（2026/01/14 新增）
- [x] 優化訂房確認郵件 - 自動附加銀行帳號和轉帳指示
- [x] 在後台添加每日對帳報表功能
- [ ] LINE Messaging API 自動通知（需要額外付費，暗時不實現）
